PROGRAM testSLASDT
  IMPLICIT NONE
  INTEGER, PARAMETER :: N = 8, MSUB = 3
  INTEGER :: LVL, ND, I
  INTEGER, ALLOCATABLE :: INODE(:), NDIML(:), NDIMR(:)

  ALLOCATE(INODE(N), NDIML(N), NDIMR(N))

  CALL SLASDT(N, LVL, ND, INODE, NDIML, NDIMR, MSUB)

  PRINT *, 'Fortran Test Result:'
  PRINT *, 'LVL:', LVL
  PRINT *, 'ND:', ND
  PRINT *, 'INODE:', INODE(1:ND)
  PRINT *, 'NDIML:', NDIML(1:ND)
  PRINT *, 'NDIMR:', NDIMR(1:ND)

  DEALLOCATE(INODE, NDIML, NDIMR)
END PROGRAM testSLASDT

SUBROUTINE SLASDT(N, LVL, ND, INODE, NDIML, NDIMR, MSUB)
  INTEGER, INTENT(IN) :: N, MSUB
  INTEGER, INTENT(OUT) :: LVL, ND
  INTEGER, INTENT(OUT) :: INODE(*), NDIML(*), NDIMR(*)

  REAL :: TWO
  PARAMETER (TWO = 2.0E+0)
  INTEGER :: I, IL, IR, LLST, MAXN, NCRNT, NLVL
  REAL :: TEMP

  MAXN = MAX(1, N)
  TEMP = LOG(REAL(MAXN) / REAL(MSUB + 1)) / LOG(TWO)
  LVL = INT(TEMP) + 1

  I = N / 2
  INODE(1) = I + 1
  NDIML(1) = I
  NDIMR(1) = N - I - 1
  IL = 0
  IR = 1
  LLST = 1

  DO NLVL = 1, LVL - 1
     DO I = 1, LLST
        IL = IL + 2
        IR = IR + 2
        NCRNT = LLST + I - 1
        NDIML(IL) = NDIML(NCRNT) / 2
        NDIMR(IL) = NDIML(NCRNT) - NDIML(IL) - 1
        INODE(IL) = INODE(NCRNT) - NDIMR(IL) - 1
        NDIML(IR) = NDIMR(NCRNT) / 2
        NDIMR(IR) = NDIMR(NCRNT) - NDIML(IR) - 1
        INODE(IR) = INODE(NCRNT) + NDIML(IR) + 1
     END DO
     LLST = LLST * 2
  END DO
  ND = LLST * 2 - 1

END SUBROUTINE SLASDT